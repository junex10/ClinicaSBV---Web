<app-header></app-header>
<div class="g-sidenav-show bg-gray-200 h-100">
    <div class="main-content position-relative max-height-vh-100 h-100">
        <!-- Navbar -->
        <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur"
            navbar-scroll="true">
            <div class="container-fluid py-1 px-3">
                <nav aria-label="breadcrumb">
                    <h1 class="font-weight-bolder mb-0" [ngStyle]="{'font-size': '20px'}">Solicitud de Citas Médicas
                    </h1>
                </nav>
            </div>
        </nav>
        <div class="container-fluid px-2 px-md-4 form">
            <div class="card card-body mx-3 mx-md-4 mt-n6">
                <div class="row gx-4 mb-2">
                    <ng-container *ngIf="actualStep === STEPS.TAB_DATE">
                        <div class="col-auto" (click)="back()">
                            <i class="fa-solid fa-arrow-left" [ngStyle]="{'font-size': '24px'}"></i>
                        </div>
                    </ng-container>
                    <div class="col-auto my-auto">
                        <div class="h-100">
                            <h5 class="mb-1">
                                Solicitar una Cita
                            </h5>
                        </div>
                    </div>
                    <div class="col-auto ml-auto">
                        <div id="step">
                            {{ actualStep }}/2
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <form [formGroup]="form" autocomplete="off" (submit)="submit()">
                            <ng-container *ngIf="actualStep === STEPS.TAB_DATA">
                                <div class="card card-plain h-100" [ngStyle]="{'border': 'none'}">
                                    <div class="card-body p-3">
                                        <hr class="horizontal gray-light my-4">
                                        <div class="row">
                                            <div class="col-xl-4 col-md-4 col-sm-12 col-12 row">
                                                <div class="col-auto w-100">
                                                    <div
                                                        class="avatar avatar-xl position-relative d-block m-auto w-50 h-50">
                                                        <img [src]="patientSelected.photo" alt="Imagen de usuario"
                                                            class="w-100 border-radius-lg shadow-sm">
                                                    </div>
                                                </div>
                                                <div class="col-12 mt-4">
                                                    <div class="h-100">
                                                        <h5 class="mb-1" [ngStyle]="{'text-align': 'center'}">
                                                            {{ patientSelected.name ?? '' }}
                                                        </h5>
                                                        <p class="mb-0 font-weight-normal text-sm"
                                                            [ngStyle]="{'text-align': 'center'}">
                                                            {{ patientSelected.lastname ?? '' }}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-8 col-md-8 col-sm-12 col-12 row">
                                                <div class="col-12">
                                                    <mat-form-field class="input" appearance="standard">
                                                        <mat-label>Paciente</mat-label>
                                                        <mat-select formControlName="patient"
                                                            (selectionChange)="getUser()" required>
                                                            <mat-option *ngFor="let item of patient"
                                                                [value]="item.value">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </mat-select>
                                                        <mat-error
                                                            *ngIf="form.controls['patient'].errors?.required && form.controls['patient'].touched">
                                                            Debe seleccionar a un Paciente
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <div class="col-xl-6 col-md-6 col-sm-12 col-12">
                                                    <mat-form-field class="input" appearance="standard">
                                                        <mat-label>Especializaciones</mat-label>
                                                        <mat-select formControlName="specialization"
                                                            (selectionChange)="getDoctorBySpecialization()" required>
                                                            <mat-option *ngFor="let item of specialization"
                                                                [value]="item.id">
                                                                {{ item.name }}
                                                            </mat-option>
                                                        </mat-select>
                                                        <mat-error
                                                            *ngIf="form.controls['specialization'].errors?.required && form.controls['specialization'].touched">
                                                            Debe seleccionar una especialidad
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <div class="col-xl-6 col-md-6 col-sm-12 col-12">
                                                    <mat-form-field class="input" appearance="standard">
                                                        <mat-label>Doctores</mat-label>
                                                        <mat-select formControlName="doctor"
                                                            [disabled]="doctors.length <= 0" required>
                                                            <mat-option *ngFor="let item of doctors"
                                                                [value]="item.doctor.id">
                                                                {{ item.doctor.person.name }}
                                                            </mat-option>
                                                        </mat-select>
                                                        <mat-error
                                                            *ngIf="form.controls['doctor'].errors?.required && form.controls['doctor'].touched">
                                                            Debe seleccionar un doctor
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <div class="col-12">
                                                    <mat-form-field class="input" appearance="standard">
                                                        <mat-label>Razón de la cita</mat-label>
                                                        <input matInput formControlName="medical_reason"
                                                            name="medical_reason" required>
                                                        <mat-error
                                                            *ngIf="form.controls['medical_reason'].errors?.required && form.controls['medical_reason'].touched">
                                                            Razón de la cita requerida
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <div class="col-12">
                                                    <mat-form-field class="input" appearance="standard">
                                                        <mat-label>Descripción de la cita</mat-label>
                                                        <textarea matInput placeholder="Descripción"
                                                            formControlName="medical_description"
                                                            required="false"></textarea>
                                                        <mat-error
                                                            *ngIf="form.controls['medical_description'].errors?.required && form.controls['medical_description'].touched">
                                                            Descripción de la cita
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>
                                            </div>
                                            <div class="col-12 mt-4">
                                                <button mat-raised-button class="button btn-success w-100"
                                                    (click)="next()">Siguiente</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="actualStep === STEPS.TAB_DATE">
                                <mat-form-field class="input" appearance="standard">
                                    <mat-label>Fecha de la cita</mat-label>
                                    <input matInput [matDatepickerFilter]="filterByControls" [min]="minDate"
                                        [matDatepicker]="picker" formControlName="date_cite" required="false">
                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                    <mat-datepicker touchUi #picker></mat-datepicker>
                                </mat-form-field>
                                <div class="col-12 mt-4">
                                    <button mat-raised-button class="button btn-success w-100">Enviar</button>
                                </div>
                            </ng-container>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>